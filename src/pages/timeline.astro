---
import Layout from '../layouts/Layout.astro';
import { timelineData } from '../content/static_pages/timelineEntry';

const CLASS_COLORS = {
  feat:   'bg-blue-50 text-blue-700 border-blue-200',
  edu:    'bg-purple-50 text-purple-700 border-purple-200',
  fix:    'bg-orange-50 text-orange-700 border-orange-200',
  init:   'bg-emerald-50 text-emerald-700 border-emerald-200',
  default: 'bg-gray-50 text-gray-700 border-gray-200'
};

// Calcolo totale commits per statistica header
const totalCommits = timelineData.reduce((acc, group) => acc + group.milestones.length, 0);

---

<Layout>
    <div class="max-w-3xl mx-auto py-16 px-4 sm:px-6">
        
        <!-- Header -->
        <div class="mb-10 pb-4 border-b border-gray-200 flex items-center justify-between">
            <h1 class="text-xl font-mono font-semibold text-gray-900">
                <span class="text-gray-400">git log</span> --graph
            </h1>
            <span class="text-xs text-gray-400 font-mono">{totalCommits} commits</span>
        </div>

        <div class="relative ml-2 md:ml-4">
            <!-- Linea Verticale -->
            <div class="absolute top-3 bottom-0 left-[15px] w-px bg-gray-200 -z-10"></div>

            <div class="space-y-10">
                {timelineData.map((group) => (
                    <div class="relative">
                        
                        {/* Header Anno */}
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-8 h-8 flex items-center justify-center bg-white z-10 border border-transparent">
                                <svg class="w-4 h-4 text-gray-400" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M10.5 3.75a2.25 2.25 0 1 1-4.5 0 2.25 2.25 0 0 1 4.5 0Zm-3.75 2.2V6.5a.75.75 0 0 0 1.5 0v-.505c0-.015.01-.027.025-.027h.907a3.75 3.75 0 0 1 3.204 2.05l.004.008 2.067 4.133a.75.75 0 0 1-1.341.67L11.05 8.7a2.25 2.25 0 0 0-1.923-1.23h-.907A1.527 1.527 0 0 1 6.75 6.5v-.55a2.25 2.25 0 1 1-2.99-2.07l1.79 5.37a.75.75 0 0 1-1.423.474L2.25 4.125V14.5a.75.75 0 0 1-1.5 0V3.75a2.25 2.25 0 0 1 2.25-2.25Z" />
                                </svg>
                            </div>
                            <span class="text-xs font-mono font-bold text-gray-600 bg-gray-100 px-2 py-0.5 rounded border border-gray-200">
                                Year {group.year}
                            </span>
                        </div>

                        {/*  Card Container */}
                        <div class="ml-8 border border-gray-200 rounded-lg bg-white shadow-sm overflow-hidden">
                            {group.milestones.map((item, idx) => {
                                const tagStyle = CLASS_COLORS[item.class] || CLASS_COLORS.default;
                                
                                return (
                                    <div class={`
                                        flex flex-col sm:flex-row sm:items-start justify-between 
                                        p-4 hover:bg-gray-50 transition-colors gap-3 sm:gap-6
                                        ${idx !== group.milestones.length - 1 ? 'border-b border-gray-100' : ''}
                                    `}>
                                        <!-- Sinistra: Info -->
                                        <div class="flex-1 min-w-0">
                                            <div class="flex items-center flex-wrap gap-2 mb-1.5">
                                                <h3 class="text-sm font-semibold text-gray-900 leading-snug">
                                                    {item.title}
                                                </h3>
                                                <span class={`text-[10px] font-mono uppercase font-semibold px-1.5 py-0.5 rounded border ${tagStyle}`}>
                                                    {item.class}
                                                </span>
                                            </div>
                                            <p class="text-xs text-gray-500 leading-relaxed font-normal">
                                                {item.description}
                                            </p>
                                        </div>

                                        {/* <!-- Destra: Meta Dati --> */}
                                        <div class="flex items-center gap-3 flex-shrink-0 self-start mt-1 sm:mt-0 sm:self-center">
                                            <span class="text-xs text-gray-400 font-mono hidden sm:inline-block">
                                                {new Date(item.date).toLocaleDateString('en-US', {month: 'short', day: 'numeric'})}
                                            </span>
                                            <div class="flex items-center gap-1 group/hash cursor-pointer">
                                                <span class="font-mono text-xs text-blue-600 bg-blue-50/50 px-1.5 py-0.5 rounded border border-transparent group-hover/hash:border-blue-200 transition-all">
                                                    {item.id}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                ))}
            </div>

            <div class="mt-8 ml-8 flex items-center gap-2 text-gray-400 opacity-60 pb-10">
                <div class="w-1.5 h-1.5 bg-gray-400 rounded-full"></div>
                <span class="text-xs font-mono">End of history</span>
            </div>
        </div>
    </div>
</Layout>
